{% macro jsBlock(code) %}
  {% set id = 'code-block-' | index %}
  <div class="flex flex-col justify-between items-start gap-5 bg-surfaceContainer" id="{{ id }}">
    <div class="code-editor"></div>
    <button class="run-code-button bg-primary text-onPrimary rounded-full p-2">Run Code</button>
    <div class="output hidden"></div>
    <script src="https://unpkg.com/codejar"></script>
    <script>
      const codeBlock = document.querySelector('#{{ id }}');
      const codeEditor = codeBlock.querySelector('.code-editor');
      const output = codeBlock.querySelector('.output');
      const button = codeBlock.querySelector('.run-code-button');
      const codejar = CodeJar(codeEditor, (editor) => {
        editor.setValue(`{{ code | trim }}`);
      }, {
        tab: '  ',
        indentOn: /{$/,
        spellcheck: false,
        catchTab: true,
        preserveIdent: true,
        addClosing: true,
        history: true,
        color: '#333',
        background: '#f5f5f5',
        highlight: (editor) => {
          const code = editor.textContent;
          const highlighted = Prism.highlight(code, Prism.languages.javascript, 'javascript');
          editor.innerHTML = highlighted;
        },
      });
      button.addEventListener('click', () => {
        try {
          const result = eval(codejar.toString());
          output.textContent = result;
        } catch (error) {
          output.textContent = error.message;
          output.classList.add('text-error');
          output.classList.add('!block');
        }
        // remove button
        button.remove();
      });
    </script>
  </div>
{% endmacro %}
